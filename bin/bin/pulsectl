#!/bin/bash

get_pa_sink() {
    pactl list | grep Sink | awk '/Sink/{print $2}' | grep \# | sed s/\#//
}

fix_pulse() {
  ORIG_VOLUME=$(pacmd list-sinks|grep -A 15 "* index: "| \
                awk '/volume: front/{ print $5 }' | sed 's/%//g')
  for i in $SINKS; do
    pactl set-sink-volume "$i" "${ORIG_VOLUME}%"
  done
}

pa_down() {
    for i in $SINKS; do
        pactl set-sink-volume "$i" -5%
    done
}

pa_up() {
    for i in $SINKS; do
        VOLUME=$(pacmd list-sinks|grep -A 15 "index: $i"| \
            awk '/volume: front/{ print $5 }' | sed 's/%//g')
        END=$((VOLUME + 5))
        if [ $END -gt 100 ]
            then if [ $END -lt 105 ] ; then
                    pactl set-sink-volume "$i" +$((100 - VOLUME))%
            else
                exit 2
            fi
        else
            pactl set-sink-volume "$i" +5%
    fi
    done
}

pa_force_up() {
    for i in $SINKS; do 
        pactl set-sink-volume "$i" +5%
    done
}

pa_mute() {
    for i in $SINKS; do
       pactl set-sink-mute "$i" toggle
   done
}

SINKS=$(get_pa_sink)
export SINKS

if [[ $(echo "$SINKS" | wc -l) -gt 1 ]]; then 
  fix_pulse
fi

case "$1" in
    down)
        pa_down
        ;;
    up)
        pa_up
        ;;
    force)
        pa_force_up
        ;;
    mute)
        pa_mute
        ;;
    *)
        echo "Usage: $0 {up|down|force|mute}"
        exit 1
esac
